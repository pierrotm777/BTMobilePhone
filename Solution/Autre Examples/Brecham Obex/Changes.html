<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>OBEX library &mdash; Changes</title>
    <!-- Use NDoc's stylesheet -->
    <link rel="stylesheet" type="text/css" href="MSDN.css" />
    <!-- But override the stupid margin//width -->
    <style type="text/css">
			body {margin: 15px; width: auto}
		</style>
    <style type="text/css">
			//code.inline { font-weight: bold; }
			code.sample { display: block; /* white-space: pre;*/ padding-left: 2em; }
			dt { font-weight: bold; }
			dd { margin-left: 1em; }
		</style>
</head>
<body style="background-color: #ffffff">
    <h1>
        OBEX library &mdash; Changes</h1>
    <p>
        12<sup>th</sup> October 2008 — release 1.7 (1.7.1012).</p>
    <!-- ___________________________________________________________ -->
    <h2>
        What&rsquo;s new</h2>
    <p>
        In the core library, in brief:</p>
    <ul>
        <li>The listings produced by some SonyEricsson and LG phones include a user-perm (permissions)
            attribute with an empty value.&nbsp; This is disallowed by the Folder-Listings DTD
            in the OBEX specification, and thus the .NET XmlReader fails on reading that attribute,
            with &#x201C;The 'user-perm' attribute has an invalid value according to its data type.&#x201D;.&nbsp;
            We have included a modified DTD in the library which permits the emtpy string,
            and the Folder-Listing parser class now uses it by default.&nbsp; For more information
            see the class documentation for Brecham.Obex.Objects.ObexXmlResolver.UseVerbatimFolderListingsDtd.&nbsp;
        </li>
        <li>Previously when reading a Folder-Listing, the operation generally was completed by sending
            an ABORT pdu to the server. &nbsp;Now a normal GET close is carried out.&nbsp; The
            ABORT pdu causes no problems as far as I know but thought I&#x2019;d fix it anyway in case
            the ABORT appears to server logs and might confuse someone. This occurred due to
            our workaround for the bug in listings produced by Broadcom/Widcomm where the listing
            XML ends with a null byte.&nbsp; We previously didn&#x2019;t read to the very end of the
            listing as the null byte caused the .NET XmlReader to fail.&nbsp; Now we read to
            the end of the stream and swallow the error produced, and thus a
            normal closing GET operation is sent.</li>
        <li>Added an Authentication class which contains some method to create an parse the various
            OBEX Authentication headers, and also to do the secure hash of the password.&nbsp; These
            methods are currently marked as: &#x201C;Prelimary code, may change or disappear in later
            versions.&#x201D; Please give me your feedback! </li>
    </ul>
    <p>
        There were no changes in the samples.</p>
    <h2>
        Release 1.6 changes</h2>
    <p>
        In the core library, in brief:</p>
    <ul>
        <li>Add option <code>IgnoreBadDateFormats</code> to ObexFolderListingParser, to allow
            it to continue even when the server produces invalid folder-listing content.&nbsp;
            For instance the LG K800 phone sometimes produces date values like <code>modified="19800000T-90000"</code>
            a negative time!</li>
        <li>Added ObexClientSession.PutFile which takes a pathname parameter of the file to
            send. </li>
        <li>Add a <code>Headers</code> property to the ObexResponseException which lists the
            headers received along with the error response.</li>
    </ul>
    <p>
        In the samples, in brief:</p>
    <ul>
        <li>In FolderExplorer samples add handling of OBEX failure response in calling SetPath.</li>
        <li>In FolderExplorer samples a "Ignore Folder Listing Faults" menu option, which set
            the various ObexFolderListingParser options including <code>IgnoreBadDateFormats</code>.
        </li>
        <li>In the desktop FolderExplorer sample add basic printing support.</li>
        <li>In GetFolderListing use the HasSize property rather than printing a size regardless,
            or skipping it if it is zero.</li>
    </ul>
    <h2>
        Release 1.5 changes</h2>
    <p>
        In the core library, in brief:</p>
    <ul>
        <li>Support for NETCFv1.</li>
        <li>All NETCF code has been tested on real devices including running the full test-suite
            there (~700 unit tests, plus IrDA-specified tests and the sample programs).</li>
        <li>Support for Mono (<a href="http://www.mono-project.com/Main_Page">http://www.mono-project.com/Main_Page</a>),
            tested on Windows and on Linux, on versions 1.2.4, 1.2.5 and 1.2.6.&nbsp; For the
            library in
            1.2.4 some differences in behaviour remain, for instance on certain invalid Folder-Listings a NullReferenceException occurs (Mono
            bug <a href="http://bugzilla.ximian.com/show_bug.cgi?id=80231">80231</a>)
            instead an XML exception, and in certain cases of calling Abort with an ObexPutStream/ObexGetStream
            a MissingMemberException occurs rather that an ObjectDisposedException.&nbsp; The
            samples work fully in 1.2.6 and some of them work in earlier versions, however the BackgroundWorker
            component in Mono prior to 1.2.6 is not thread-safe so bad behaviour can occur in samples that use it. </li>
        <li>Added a <code>HasSize</code> property and a corresponding <code>ResetSize</code> method to
            <code>ObexFileOrFolderItem</code> class, and thus to <code>ObexFolderItem</code>, and 
            <code>ObexFileItem</code> classes.&nbsp; This allows one to know whether
            a size was included in the folder-listing, or whether the folder-listing item
            simply did not have a size value.  See the FolderExplorer sample Details view for an example
            of using these properties.&nbsp; </li>
        <li>The ProtocolViolationException message when parsing an incorrectly formatted received
            PDU now reports information about the location of the fault, for example &#x201C;Overrun PDU in parsing at index: 3, location: 'pre-header-bytes', pduLength: 3.&#x201D;
        </li>
        <li>A fix to workaround the bug in various servers where a connect response packet
            signalling an error is in a bad format (it doesn't contain the necessary connect bytes).&nbsp; We detect the short response when it has an error code and suppress the ProtocolViolationException
            in that case so that the &#x2018;bad response code error&#x2019; can occur. </li>
        <li>A fix to workaround the bug in the Widcomm servers, where a connect response packet
            signalling an error has zero in the maximum-packet-size field. </li>
        <li>A fix to workaround the Widcomm Abort fault where it returns an illegal Final PDU.&nbsp; We now ignore any such invalid responses in that case.</li>
        <li>Adding null Byte-Array headers disallowed.</li>
    </ul>
    <p>In the samples, in brief:</p>
    <ul>
        <li>Updated to use version 2.2 of the InTheHand 32feet.NET library.&nbsp; Note that
            the NullReferenceException that would occur when attempting a Bluetooth connection
            on a CE/PPC device without the Microsoft Bluetooth stack was an issue in that library and has been fixed (their workitem <a
                href="http://www.codeplex.com/32feet/WorkItem/View.aspx?WorkItemId=11744">11744</a>).</li>
        <li>Added TraceStream to the TransportConnections library, providing simple diagnostic of stream operations for NETCF.&nbsp; Use
            network tracing on the full framework, see the 
            &#x201C;Samples/Enable Network Logging, rename to app.exe.config&#x201D; file. </li>
        <li>UriObexSessionConnection did not support the scheme "obex:" and new constructors
            taking a BluetoothAddress or IrDAAddress and a scheme. Some checking of command format in GetFolderListings. </li>
        <li>A fix to workaround a fault in the NETCFv1 where TcpClient fails to connect to a
            peer where the target is an IPAddress string.</li>
        <li>Form titles all made to match the application&#x2019;s name.</li>
        <li>FolderExplorer opens the GET operation in the sub form which also provides must
            better error handling and reporting. </li>
        <li>FolderExplorer on NETCF, fix the Close button state after cancel/fail fix.</li>
        <li>FolderExplorerSp (SmartPhone) renaming of Soft Key menu 2. </li>
        <li>Mark manual new threads as ‘IsBackground=true’ to ensure that they don't keep the program
            around after the form is closed.</li>
        <li>Handle IOException on conn.Connect()</li>
    </ul>
    <h2>
        Beta 3 changes</h2>
    <p>
        In the core library, in brief:</p>
    <ul>
        <li>Access to the response metadata headers in a GET request is provided via the <code>
            ResponseHeaders</code> property on <code>ObexGetStream</code>.&nbsp; This can be
            used to find the length of the object being downloaded.&nbsp; See the FolderExplorer2
            sample which uses this feature to update the progress bar. </li>
        <li>GET (GetTo/Get) did not work on the NETCF; failing with an InvalidCastException.&nbsp;
            This has been fixed. </li>
        <li>Code to run the NUnit-based unit-tests on the NETCF has been created to 
            ensure the code quality of the complete library on that platform. </li>
        <li>The Folder Listing parser failed on the NETCF when reading listings from most peer devices.&nbsp; This is due to a lack of support for DTDs in the NETCF
            XmlTextReader class, if used on a document that contains a DOCTYPE
            element it throws a NotSupportedException. This is bad,
            as the Folder Listing document is defined in the OBEX specification by a DTD and
            all the documents I've see do contain the document type declaration.&nbsp; This
            has been worked-around by creating code to strip any DOCTYPE element from received
            documents.</li>
        <li>It also has been reported that some devices produce Folder Listing XML documents
            containing null
            bytes.&nbsp; When first writing the parser I had been aware that some devices included
            null bytes at the end of the document, and thus the parser is careful to read no
            further that the document end tag.&nbsp; However due to reports
            of some documents having null bytes in the middle
            of the document has meant creating another bit of &#x2018;stripping&#x2019; code.
            &nbsp;This is disabled by default as I&#x2019;ve seen no such documents showing this. This applies
            to both platforms.</li>
        <li>The <code>SetPath</code>, <code>SetPathUp</code>, and <code>SetPathReset</code> methods
            have been changed to set the flag that indicates not to create a folder when it doesn't already exist by default.&nbsp; This was done particularly to suit some device types which prompt the user
            to allow an 'up' change even though the
            parent folder does exist. This could be a breaking
            change for code which uses the <code>SetPath(String)</code> method in particular.
            The method which used to take <code>boolean</code> arguments for the flags has also been
            changed to use <code>enum</code> values instead.</li>
        <li>There has been one breaking change in the Pdus namespace, the values of the ObexPduType
            enum have changed. So, don't redirect an application compiled against Beta 2 to this
            version, instead recompile. I aim for this to be the last such change. </li>
        <li>Class documentation has been completed on all the main library classes, in particular
            on the <code>ObexPduFactory</code> class.</li>
        <li>The class methods meant only for &#x2018;advanced&#x2019; usages have been marked
            as such; firstly with the text &#x201C;[Advanced usage]&#x201D; in their parameter
            documentation, and secondly with <code class="inline">System.ComponentModel.EditorBrowsableState.Advanced</code>
            to control their appearance in Intellisense.</li>
    </ul>
    <p>In the samples, in brief:</p>
    <ul>
        <li>The NETCF Windows Forms samples in the previous version were pretty much useless.&nbsp;
            Whilst the library (and the command-line program) did work, the UI samples (and
            the IrDA-specified tests) did not &mdash; due to threading issues.&nbsp; The samples have now been recreated
            in a full version of VS, tested, and they all seem to work fine in the emulator.
            However a beta tester reports that they do not work for him
            on a real device. As the complete source for the samples is included, can any Compact
            Framework experts give me any recommendations for changes so that they do work.</li>
        <li>Both the <code>GuiObexSessionConnection</code> class and the <code>ConsoleMenuObexSessionConnection</code>
            in the TransportConnection library now support TCP/IP connections.&nbsp; They connect
            to the specified default port of 650, with the <code>GuiObexSessionConnection</code>
            class displaying a prompt dialog box for the IP Address or hostname, and the <code>ConsoleMenuObexSessionConnection</code>
            class prompts on the console. With Alan's help support for both IPv4 and IPv6 has
            been verified. </li>
        <li>A new Forms Control <code>ProtocolComboBox</code> is included in the TransportConnection
            library, it represents a drop-down list from which the user can select Bluetooth,
            IrDA, or TCP/IP.&nbsp; It returns the selected protocol as a <code>System.Net.Sockets.ProtocolFamily</code>
            value.&nbsp; All the UI samples have been updated to use this control.</li>
        <li>FxCop has been run on the library and all major recommendations followed.</li>
    </ul>
    <h2>
        Beta 2 changes</h2>
    <ul>
        <li>Folder-Listing XML parser. See classes <code class="inline">Brecham.Obex.Objects.FolderListing</code>
            and <code class="inline">Brecham.Obex.Objects.FolderListingParser</code>, and method
            <code class="inline">GetFolderListing</code> on class <code class="inline">Brecham.Obex.ObexClientSession</code>.
        </li>
        <li>ObexClientSession. Addition of <code>GetFolderListing method</code>. It is also
            now implements <code>IDisposable</code>, calling its <code>Dispose</code> method
            will close the underlying stream. Also one fix, Connect and Delete can be called
            after Abort. </li>
        <li>GetFolderListing sample updated to use the folder-listing parser, printing folder
            contents in the same style as Windows&rsquo; DIR command, also now supports download
            of any file types. </li>
        <li>There are also a number of new sample projects all for VB.NET, as the feedback clearly
            showed that they were important. They are VbPutSample, PutGuiVb, GetFirstListedFile,
            and FolderExplorerVb. See below. Also the source for the GetFolderListing is now
            included. </li>
        <li>The samples now includes a library to handle creating connection to OBEX servers
            over both Bluetooth or IrDA, and also handle disconnect and clean-up. It includes
            three classes, one to handle connections in a GUI application, one for console menu-driven
            applications like GetFolderListings, and one that accepts a URI of a similar format
            to that used by 32feet.NET&#x2019;s ObexWebRequest class. </li>
        <li>In Beta 1 the command-line programs built for the NETCF were incorrectly being compiled
            as type WinExe so produced no console output, this has been fixed in this release.
            Unfortunately the VB samples could not be compiled for the NETCF, the VB compiler
            exploding when asked to do so&hellip; </li>
        <li>Exceptions now serializable. Also, <code>ObexCreateTooLongException</code> was moved
            to the <code>Pdus</code> namespace. </li>
    </ul>
    <!-- ___________________________________________________________ -->
    <h2>
    </h2>
    <p>
        Andy Hume
    </p>
</body>
</html>
